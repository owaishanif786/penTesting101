#!/usr/bin/python3

import socket, os, sys

def retBanner(ip, port):
    try:
        socket.setdefaulttimeout(2)
        s = socket.socket()
        s.connect((ip, port))
        banner = str(s.recv(1024))
        return banner
    except Exception as e:
        print ("[-] {}:{} {}".format(ip, port,e) )


def checkVulns(banner, filename):
    f  = open(filename, 'r')
    for line in f.readlines():
        if line.strip("\n") in banner:
            print ('[+] Server is vulnerable: {}'.format(banner.strip('\n')))



def main():
    if len(sys.argv) == 2:
        filename = sys.argv[1]
        if not os.path.isfile(filename):
            print("[-] {} does not exists".format(filename))
            exit(0)
        if not os.access(filename, os.R_OK):
            print("[-] {} permission  denied".format(filename))
            exit(0)
    else:
        print ("[-] Usage: {} <vuln filename> ".format(sys.argv[0]) )
        exit(0)
    
    
    portList = [21, 22, 25, 80, 110, 443]
    for x in range(1, 255):
        for port in portList:
            ip = '10.5.4.' + str(x)
            banner = retBanner(ip, port)
            if banner:
                checkVulns(banner, filename)
        

if __name__ == '__main__':
    main()


        




        

